Mars

"?" - Denote considerable talking points.

[General Requirements/Features]

= Location-based search engine =
  
	- User can specify an explicit location "near [city or town]".
		- Default Case: Location near the user(if available).
		- If device-location information is not available and no query-location keyword provided, then what(?)
  
	- The user can specify whether they are searching meals or restaurants.
	
	- Anyone can access the search engine and view ratings.
  
= User Account Registration and Management =

	- Incredibly fast and simple account registration system to allow users to quickly and easily register
	user accounts and begin providing content instantaneously. 
		- Simply ask for the email address and password, provide a captcha or another basic measure(?) to discourage artificial registrations.
		- Make the user name optional, a username would be auto-generated if one is not provided.
		- Account confirmation/activation is handled via email.(I would include a text message option` but that would be an additional field to fill out.)

	- Track user's contribution(rating history) to discourage multiple recommends on the same meal item and to also track eating preferences.
	
= Menu Item/Meal Ratings System =

	- Simply two choices("Don't Recommend, "Recommend"). Scores are calculated based off of the ratio of the number of "Don't Recommend" and "Recommend" votes
	and the total number of responses. Additional optional metrics include a Cost and Portion-Size which could be used to calculate the menu item's cost effectiveness.
		- I'm thinking of making the cost and portions two point metrics as well from the user's perspective.(Cheap, Expensive / Small, Large) and allow a middle value to be the default is neither
		is chosen for either category.
		Example: User chooses Expensive for cost but nothing for Portion Size because it was neither small or large, the submission of these metrics are paired so the absence
		of user input for portion would default to a middle value. Vice versa for cost.
	
	- Restaurant scores could be generated by a composition of their individual menu offerings' scores; with restaurants that have a larger amount of menu offerings with 
	higher scores having a higher restaraunt score as a result.
	
	- Businesses can track trends in meals and change/improve accordingly.
	
[Competing Products with Similar Concepts]
I did a cursory review of google results of trying to find similar products.

- Yelp, Zomato(Urbanspoon), Zagat.
  All are restaurant-centric rating systems but they don't seem to focus on specific meals.
 
- "Ripe - What's Good?", the most similar existing product I've found. An iOS-only app which uses a numeric rating system 
  for menu items to help users determine which meals are the best at a specific restaurant. Relatively obscure and new(released August 2015).
  
  I think that making this a binary-rating system that is browser-bound and cross-platform rather than a native app would greatly simplify things for the user.
  Also, the ability to search for highly recommended specific meal-types near your location would be a feature that I don't see implemented in
  their product.
  	
[Implementation Details and Considerations]

[Agents]

- Anonymous Browser(i.e., anyone)
  Ability to browse existing rating information from the search-engine.

- General Registered User(i.e., the customer)
  Ability to contribute to scores, view previous scoring histories and trending restaraunt visiting information based off contributions.
  
- Content Contributor(i.e., business, moderator role)
  Ability to add/modify restaurant and menu offering information.
   
[Entitites]

- Restaurant 
  Self-explanatory. Contains relevant restaurant information, mainly just the name and location for querying purposes. Possibly a picture.

- Menu Offering/Meal
  The object of focus. Propeties include the different rating metrics(# don't recommend, # recommend, cost-score, portion-score), name,
  short description, related tags for searching purposes.

Possible Database Structure
---------------------------

[users]
"id" - GUID or UUID for referencing users within the database.
"username" - Display purposes; auto-generated if not provided.
"email_address" - Login/Notification purposes.
"password" - Use the current standard hashing algorithm(Password->Base64->BCrypt?)
"active" - For account activation purposes.
"registration_date" - General additional auto-generated information.
"moderator" - Flag to denote if the user is a moderator.

[restaurants]
"id" - GUID or UUID for restaurants.
"restaurant_name" - Self explanatory. 
"location_address" - General address that can be parsed into a more generic location information for querying purposes. This could be broken out into separate fields for street address, town, zip, state, province, country, so forth.
"geo_lat" - Self explanatory.
"geo_long" - Self expanatory.
"file_path" - File path to any stored restaurant images.
"created_by_user" - User thar it was created by.
"active"

[restaurant_tags]
"restaurant_id" - The restaurant's ID.
"tag_id" - The tag ID.

[meals]
"id" - GUID or UID for meals.
"restaurant_id" - The parent restaurant's ID to define the relationship between meals and restaurants. 
"category" - Menu category(e.g., appetizers, entrees, salads, soups, desert)
"description" - General description.
"file_path" - File path to any stored meal images.
"created_by" - The user which created it.
"active"

[meal_tags]
"meal_id" - The meal's ID to define the relationship between the meal and tags for querying purposes.
"tag_id" - The tag keyword.

[tags]
"id"
"text" - Tag text.

[meal_ratings]
"meal_id" - The combination of the meal_id and user_id defines which user rated which meal and the resulting rating.
"user_id"
"rating" - The database representation of the "Recommend" or "Don't Recommend" rating, I'm not sure if this should be a boolean(false = don't recommend or true = recommend) or a specific integer values. It really shouldn't make a difference.
"submission_time" - Rating submission time-stamp.
"user_agent" - The device's user agent attached to the rating. 

[meal_costs]
"meal_id"
"user_id"
"cost_rating" - The cost rating.
"submission_time" - Everything is the same as described above.
"user_agent"

[meal_portions]
"meal_id"
"user_id"
"portion_rating" - The portion rating.
"submission_time"
"user_agent"

Technical Information
---------------------

Hosting Environment
- I'm not really familiar with hosting web applications. I currently work in a Linux-Apache environment. We could use a online hosting solution.

Programming Stack
- The majority of my experience is with PHP, MySQL, and Javascript for server-side, database, and client-side programming respectively.

Source-Control
- Bitbucket offers free private repositories. 

Potentials Issues for Discussion
---------------------

Multiple users sharing one account and rating simultaneously.
	- I'm not completely sure where the problem may be for this since we would be disallowing duplicate ratings(same user rating the same score on the same meal).
	- However, we could employ an algorithm to detect these situations by comparing the browser-string/user-agent/geolocation information of the submission and its corresponding
	timestamp and determine if there is a case where the same user account is rating from two different locations or browsers within a very short amount of time from each other.
	
Allow users to retract their ratings?
	- Should the user able to retract their rating? 
	
Adding restaurants and meals to the system? How to do this?
	- Have a moderator role which has the ability to Add/Modify Restaurant/Meal Details.
	- Allow registered users to "Add a Restaurant" or "Add a Meal" but these additions are simply 
	stored as "suggestions" which are evaluated by the moderator before they actually appear formally
	in the system.
	

Application Structure
---------------------
*Component is essentially the page/collection of pages/view/collection of views.

------------------------------
Core Functionality Components
------------------------------

=Search/Search Results Component=
Starting point of the application. Has an input field for search terms, the ability to distinguish 
between restaurant and meals.

Elements:
- Search Input
- Radio button Group for Meal/Restaurant search distinction.
- Site Header that either displays the standard Login/Register hyperlinks or My Account/Logout hyperlinks.
- Search Button
- List of each returned meal item.
- Or list of each returned restaurant item.

Actions:
- Searching for items should return pagination of results sorted by rating with distance from queried location and correspond rating statistics. Match meals on either restaurant, meal name, tags, or category 

- User should have access to the search bar at all times to fetch a new list of results accordingly.


=Restaurant Component=
Covers basic restaurant information and possibly a picture and a list of meals offered by that restaurant that are sectioned 
off by their corresponding categories. Possibly statistical information as well(how many recommended meals).

Elements:
- Restaurant  Picture (or default image)
- Restaurant Name
- Restaurant Location Info
- Restaurant's Menu within the system, sectioned off into collapsible sections based on meal categories.

Actions: User can suggest an image for the restaurant if one doesn't already exist.

=Meal Component=
Covers basic meal information and possibly a picture, statistical rating information. If the user is logged in, the ability
to rate the meal on the above metrics.

Elements:
- Meal Picture (If provided)
- Meal Name
- Meal Rating Information, Scores, Achievements.
- Meal Description
- Meal Rating Section (Where the user selects Recommend or Don't Recommend)
- Expandable Optional Choices for Cost/Portion.

*No matter the device, all of this component's information and elements should fit in the window.

Actions:
- Disable/Hide Rating controls if user isn't logged in.
- Suggest the meal picture if one doesn't exist.
- Check to see if previous ratings for that meal from that user exists if user is logged in.
- Populate/Highlight historical choices if previous ratings by that user exists.
- If the used makes and changes to their ratings or a new rating, refresh or reload the page to shoe their contribution.


-----------------------------
Content Management Components
-----------------------------

* Client-side validations include ensuring that all required fields are filled.
* Server-side validations include sanitizing and formatting the information for DB entry.


=Add A Meal Component=
Allows the user to create and rate(optional) a meal, must be associated with a pre-defined restaurant. If it is an general user creating the meal, the meal will be pending
unless created by a moderator account.

Elements:
- Meal Picture (Optional)
- Meal Name Field
- Restaurant Dropdown
- Meal Description Field
- Meal Category Dropdown populated by predefined category values.
- Meal Tags (Generated while user types them out)
- Rating (Optional)
- Optional Cost/Portion(Optional)

Actions: 
- Client Side validation.
- User submits form.
- Server-side validation.
- If a generic user, create entries but don't activate them.
- If moderator, create entries and activate them.


=Add A Restaurant Component=
Allows the user to create a restaurant. Once the user has created a restaurant, they can begin to start creating meals for it. The restaurant and meals created for a new
restaurant will be pending unless created by a moderator account.

Elements:
- Restaurant Picture (Optional)
- Restaurant Name
- Location-Related Fields
- Restaurant Tags (Generated while user types them out)

Actions:
- Same as for the meal.

=Moderator Component=
Provides a list of pending meals and restaurants which can be formally approved or removed by the moderator user. Also the ability to view and edit/remove existing pending/non-pending
restaraunts and meals.

Elements:
- List of suggested images.
- List of Pending Meals
- List of Pending Restaurants.
- Search Engine for Meals/Restaurants to edit them. Can also edit the pending meals/restaurants.

Actions:
- Approve/Delete suggested images.
- Approve/Delete pending meals/restaurants.
  Approving a meal approves the parent restaurant if restaurant is pending.
Deleting a restaurant, deletes the meals, pending or not.
- Edit pending or not meals/restaurants.


=Edit A Meal Component=
View/Edit basic meal information or relate the meal to a different restaurant.

Elements: 
- All fields for meal information pre-populated.
- Submit Button

Actions: 
- Client Side Validation 
- User submits form.
- Server-side Validation 
- Meal information is updated.

=Edit A Restaurant=
View/Edit basic restaurant information or remove meals from restaurant.

Elements:
- Same as above but for restaurants.

Actions:
- Ditto.


-----------------------------------------------
Account Registration and Management Components
-----------------------------------------------

=Login Component=

Elements:
- Email Address Field (Required)
- Password (Required)
- Remember Me Checkbox
- Submit Button
- Register Hyperlink
- Forgot Password Hyperlink

Actions:
- Ensure that the user isn't already logged in.
- User submits the form.
- Authenticate on the values of email address and password.
- If not succesful, display unsuccessful attempt to user.
- If successful, redirect to the search page and change the site header to have a a logout and account settings link.
- Start the corresponding Ruby session.

=Register Component=

Elements:
- Email Address  Field(Required)
- Username Field (Optional)
- Password (Required)
- Confirm Password (Required)
- Submit Button

Actions:
- Ensure that the user isn't already logged in.
- Measure password strength.
- User Submits Form
- Client-side Validation
- Hash Password
- Create username if one is not provided.
- Server-side Validation
- If any errors, report them and return
error message to the user.
- Otherwise, create hash from user's email and user agent and additional static information such as a string. 
- Store the string in the "active" field of the user table with the user entry.
- Send an email with a link with a query string containing the above hash and email address for confirmation purposes.
- Redirect to the Login page.


=Account Activation Component=

Actions:
- Retrieve hash and email address from query string.
- Lookup user in the users table based on the email address and hash.
- If the entry isn't found. Display this error.
- Otherwise, set the active field to 1.
- Display the success and provide a link to the Login page.

=Forgot Password Component=
If the user has forgotten their password.

Elements:
- Email Address Field (Required)
- Submit Button

Actions:
- Ensure that the user isn't already logged in.
- Client-side validation.
- User Submits the form.
- Server-side Validation
- Check if the user account is active.
- If not, inform user to activate their account.
- Otherwise, create a hash from the email, user agent, and static string and send an email with reset password instructions and a link to the Reset Password component with the hash and password in the query string.

=Password Reset Component=
If the user clicks on the email link to formally reset their password.

Elements:
- Password Field (Required)
- Confirm Password(Required)

Actions:
- Look and ensure that there is a user entry with matching active field value and email address as the information in the query string.
- If no match, redirect the user to the main page.
- Display Password Strength as user types.
- Client-side validation.
- User submits form.
- Server-side Validation
- Hash new password and reactivate the user account.
- Display the success and provide a link to sign in.

=Undo Password Reset Component=
If the user or another user performed a "Forgot Your Password", and then decided to not reset their password.

Actions:
- Look for the matching hash value in the active field and email address.
- If it doesn't exist, redirect to the main page.
- Otherwise, remove the hash from the active field.
- Inform the user and provide a link to login.

=Change Password Component=
Allows the user to manually change their password.

Elements: 
- Current Password Field
- New Password Field
- Confirm Password Field
- Submit Button

Actions:
- Display new password strength.
- Client-side Validation.
- User submits form.
- Server-side validation.
- Authenticate that current password is true.
- If so, create new password hash and store it.
- If successful, inform the user. Likewise if not successful.


=Account Settings=
Allows the user to view basic historical information associated with their account and change their password.

Elements:
- Display of basic information.
- Display historical ratings of meals in some lost form such as dynamic div objects or table rows.
- Each object in the list includes thumbnail image, meal name, restaurant name, rating, and cost/portion if applicable.
- Object is clickable which brings up Meal component.
- Hyperlink to Change Password.

---------------------------
Meal and Restaurant Scoring
---------------------------
Meal Score 		= (# of recommends / # of responses)*100 - Closer to 100%, the better
Cost Score		= ((# of Cheap Votes)*1 + (# of Default Votes)*0.5 / (# of Responses))*100 - Closer to 100%, the cheaper.
Portion Score	= ((# of Large Portion Votes)*1 + (# of Default Votes)*0.5 / (# of Responses))*100 - Close to 100%, the bigger.

Restaurant Scores = Sum of the above scores for rated meals / Number of rated meals.

m = Meal Score
c = Cost score
p = Portion Score

r = Responses

General Tiers(With responses greater than 1) - Represented by a solid circle?
-------------
Extremely Recommended(Light Green) 	- m > 95%
Highly Recommended(Green) 			- 94% >= m >= 85%
Recommended(Blue-Green) 			- 84% >= m >= 60%
Indifferent(Blue) 					- 59% >= m >= 50%
Not Recommended(Yellow) 			- 49% >= m >= 35%
Highly Not Recommended(Orange) 		- 34% >= m >= 25%
Extremely Not Recommended(Red) 		- 24% >= m >= 0%
Not Rated(Gray) 					- No responses.

Cost/Portion Markers(With responses greater than 1)
--------------------
Green Dollar Sign 	- c >= 85%
Blue Dollar Sign 	- 84% >= c >= 75%
Orange Dollar Sign	- 25% >= c >= 16%
Red Dollar Sign 	- 15% >= c >= 0%

Green Something Sign 	- p >= 85%
Blue Something Sign 	- 84% >= p >= 75%
Orange Something Sign	- 25% >= p >= 16%
Red Something Sign 		- 15% >= p >= 0%

^^ Not sure what to put as the portion symbol yet.

Cost-Effective Meal = c,p >= 60%


Achievement				Range			Responses
-----------				-----			---------
Diamond	Fork			m >= 95%		r >= 1,000
Platinum Fork		94% >= m >= 85%		r >= 1,000
Gold Fork			84%	>= m >= 75%		r >= 1,000
Diamond Heart			m >= 95%		r >= 100
Platinum Heart		94% >= m >= 85%		r >= 100
Gold Heart			84%	>= m >= 75%		r >= 100
----------------------------------------------------
Cost and Taste Award	 m, c >= 85%	r >= 50 - Golden Dollar Sign
Portion and Taste Award	 m, p >= 85%	r >= 50 - Golden Fork and Spoon
Platinum Meal			 m, p, c >= 85% r >= 100 - Platinum Plate of Food
Gold Meal		84% >= m,c,p >= 75% 	r >= 100 - Golden Plate of Food